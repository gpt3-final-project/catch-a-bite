<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>로그인 / 회원가입</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Gowun+Batang:wght@400;700&family=Gowun+Dodum&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #f2efe9;
      --panel: #f6f3ee;
      --panel-strong: #ffffff;
      --text: #2c2b29;
      --muted: #7a746d;
      --line: #d6d0c8;
      --accent: #7c7873;
      --accent-strong: #605c57;
      --notice-success: #dfe7db;
      --notice-error: #f1d7d3;
      --notice-info: #e6e2dd;
      --shadow: 0 18px 40px rgba(28, 24, 20, 0.12);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      background:
        radial-gradient(circle at top right, #ffffff 0%, rgba(255, 255, 255, 0.4) 35%, transparent 60%),
        linear-gradient(120deg, #efece6 0%, #f6f4ef 45%, #f1ede6 100%);
      color: var(--text);
      font-family: "Gowun Dodum", "Noto Sans KR", sans-serif;
    }

    body::before {
      content: "";
      position: fixed;
      inset: 0;
      background-image: radial-gradient(rgba(120, 112, 104, 0.12) 1px, transparent 1px);
      background-size: 24px 24px;
      opacity: 0.25;
      pointer-events: none;
    }

    .auth-shell {
      width: min(1100px, 92vw);
      margin: 56px auto 80px;
      display: grid;
      grid-template-columns: 1fr;
      gap: 28px;
      align-items: start;
      justify-items: center;
      position: relative;
      z-index: 1;
    }

    .auth-shell .auth-panel { width: min(520px, 100%); }
    .auth-shell.is-signup .auth-panel { width: min(760px, 100%); }
    .auth-panel[hidden] { display: none; }

    .auth-panel {
      border: 1px solid var(--line);
      border-radius: 10px;
      padding: 26px 32px 32px;
      box-shadow: var(--shadow);
      background: var(--panel);
      animation: panel-in 0.6s ease both;
    }

    .auth-panel.login { background: var(--panel-strong); }

    .panel-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 18px;
    }

    .auth-title {
      font-family: "Gowun Batang", serif;
      font-weight: 700;
      font-size: 20px;
      margin: 0;
      letter-spacing: 0.03em;
    }

    .auth-subtitle {
      margin: 4px 0 0;
      font-size: 13px;
      color: var(--muted);
    }

    .back-link {
      border: 1px solid var(--line);
      border-radius: 999px;
      padding: 6px 12px;
      font-size: 12px;
      color: var(--accent);
      text-decoration: none;
      background: #fff;
      white-space: nowrap;
    }

    .signup-form, .login-form { display: grid; }

    .field-group {
      margin-bottom: 16px;
      animation: field-rise 0.5s ease both;
      animation-delay: calc(var(--order) * 0.05s);
    }

    .field-group label {
      display: block;
      font-size: 13px;
      color: var(--muted);
      margin-bottom: 6px;
    }

    .field-row {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 10px;
    }

    input {
      width: 100%;
      border: 1px solid var(--line);
      border-radius: 4px;
      padding: 10px 12px;
      font-size: 14px;
      font-family: inherit;
      background: #fff;
      color: var(--text);
    }

    input:focus {
      outline: 2px solid rgba(100, 96, 90, 0.2);
      border-color: var(--accent);
    }

    .ghost-button {
      border: 1px solid var(--line);
      background: #86827d;
      color: #f7f4ef;
      padding: 10px 16px;
      border-radius: 4px;
      font-size: 13px;
      cursor: pointer;
      white-space: nowrap;
    }

    .primary-button {
      margin-top: 10px;
      border: none;
      background: var(--accent);
      color: #f7f4ef;
      padding: 12px 0;
      border-radius: 6px;
      font-size: 15px;
      cursor: pointer;
      letter-spacing: 0.04em;
    }

    .notice-stack {
      display: grid;
      gap: 8px;
      margin-bottom: 18px;
    }

    .notice {
      padding: 10px 12px;
      border-radius: 6px;
      font-size: 13px;
    }

    .notice.success { background: var(--notice-success); }
    .notice.error { background: var(--notice-error); }
    .notice.info { background: var(--notice-info); }

    .line-field {
      display: block;
      margin-bottom: 18px;
      animation: field-rise 0.5s ease both;
      animation-delay: calc(var(--order) * 0.05s);
    }

    .line-field span {
      display: block;
      font-size: 13px;
      color: var(--muted);
      margin-bottom: 6px;
    }

    .line-field input {
      border: none;
      border-bottom: 2px solid #bfbab3;
      border-radius: 0;
      padding: 8px 0;
      background: transparent;
    }

    .line-field input:focus {
      outline: none;
      border-bottom-color: var(--accent);
    }

    .login-actions {
      display: flex;
      gap: 12px;
      justify-content: center;
      margin-top: 18px;
    }

    .pill-button {
      border: 2px solid var(--accent);
      background: var(--accent);
      color: #fff;
      padding: 6px 18px;
      border-radius: 999px;
      font-size: 13px;
      text-decoration: none;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    .pill-button.outline {
      background: transparent;
      color: var(--accent);
    }

    .mini-hint {
      font-size: 12px;
      color: var(--muted);
      margin-top: 6px;
      line-height: 1.4;
    }

    .inline-message {
      margin-top: 10px;
      font-size: 13px;
      padding: 10px 12px;
      border-radius: 6px;
      display: none;
    }
    .inline-message.show { display: block; }
    .inline-message.ok { background: var(--notice-success); }
    .inline-message.bad { background: var(--notice-error); }

    button:focus-visible, a:focus-visible {
      outline: 2px solid rgba(100, 96, 90, 0.4);
      outline-offset: 2px;
    }

    @media (max-width: 560px) {
      .auth-shell { width: 92vw; margin: 36px auto 60px; }
      .auth-panel { padding: 24px 22px 28px; }
      .field-row { grid-template-columns: 1fr; }
    }

    @media (prefers-reduced-motion: reduce) {
      .auth-panel, .field-group, .line-field { animation: none; }
    }

    @keyframes panel-in {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes field-rise {
      from { opacity: 0; transform: translateY(14px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>
  <div id="auth-root">
    <main class="auth-shell is-login">
      <!-- 로그인 -->
      <section class="auth-panel login" id="login-panel">
        <div class="panel-header">
          <div>
            <h1 class="auth-title">로그인</h1>
            <p class="auth-subtitle">사업자</p>
          </div>
          <a class="back-link" href="/auth/select">유형 변경</a>
        </div>

        <div class="notice-stack" th:if="${param.signup != null or param.loginSuccess != null or param.error != null or param.logout != null}">
          <div class="notice success" th:if="${param.signup}">회원가입이 완료되었습니다. 로그인해주세요.</div>
          <div class="notice success" th:if="${param.loginSuccess}">로그인에 성공했습니다. 잠시 후 이동합니다.</div>
          <div class="notice error" th:if="${param.error}">이메일 또는 비밀번호가 올바르지 않습니다.</div>
          <div class="notice info" th:if="${param.logout}">로그아웃 되었습니다.</div>
        </div>

        <form class="login-form" action="/auth/owner/login" method="post">
          <input type="hidden" th:if="${_csrf != null}" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
          <label class="line-field" style="--order: 1;">
            <span>이메일</span>
            <input name="email" type="text" autoComplete="username" required />
          </label>
          <label class="line-field" style="--order: 2;">
            <span>비밀번호</span>
            <input name="password" type="password" autoComplete="current-password" required />
          </label>
          <div class="login-actions">
            <button type="submit" class="pill-button">로그인</button>
            <button type="button" class="pill-button outline" data-action="show-signup">회원가입</button>
          </div>
        </form>
      </section>

      <!-- 회원가입 -->
      <section class="auth-panel signup" id="signup-panel" hidden>
        <div class="panel-header">
          <div>
            <h1 class="auth-title">회원 가입</h1>
            <p class="auth-subtitle">사업자</p>
          </div>
          <a class="back-link" href="/auth/select">유형 변경</a>
        </div>

        <form class="signup-form" action="/auth/owner/signup" method="post" id="owner-signup-form">
          <input type="hidden" th:if="${_csrf != null}" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

          <div class="field-group" style="--order: 1;">
            <label>이메일</label>
            <div class="field-row">
              <input
                id="signup-email"
                name="email"
                type="text"
                placeholder="owner@test.com"
                autoComplete="username"
                required
              />
              <button type="button" class="ghost-button" id="btn-check-email">중복확인</button>
            </div>
            <div class="mini-hint">예) owner@test.com</div>
            <div class="inline-message" id="email-check-message"></div>
          </div>

          <div class="field-group" style="--order: 2;">
            <label>비밀번호</label>
            <input id="signup-password" name="password" type="password" autoComplete="new-password" required />
            <div class="mini-hint">8~30자, 영문/숫자 조합 권장</div>
          </div>

          <div class="field-group" style="--order: 3;">
            <label>비밀번호 재확인</label>
            <input id="signup-confirmPassword" name="confirmPassword" type="password" autoComplete="new-password" required />
            <div class="inline-message" id="pw-match-message"></div>
          </div>

          <div class="field-group" style="--order: 4;">
            <label>대표자명</label>
            <input id="signup-name" name="name" type="text" placeholder="홍길동" required />
          </div>

          <div class="field-group" style="--order: 5;">
            <label>사업자등록번호</label>
            <input
              id="signup-businessRegistrationNo"
              name="businessRegistrationNo"
              type="text"
              placeholder="123-45-67890"
              required
            />
            <div class="mini-hint">예) 123-45-67890 (하이픈 포함/미포함 모두 가능)</div>
          </div>

          <div class="field-group" style="--order: 6;">
            <label>상호명</label>
            <input
              id="signup-storeName"
              name="storeName"
              type="text"
              placeholder="길동치킨"
              required
            />
          </div>

          <div class="field-group" style="--order: 7;">
            <label>사업장 주소</label>
            <input
              id="signup-address"
                name="storeAddress"
              type="text"
              placeholder="서울특별시 강남구 ..."
              required
            />
            <div class="mini-hint">나중에 도로명/상세 분리 가능</div>
          </div>

          <div class="field-group" style="--order: 8;">
            <label>휴대폰</label>
            <input
              id="signup-mobile"
              name="mobile"
              type="tel"
              inputMode="numeric"
              placeholder="01012345678"
              pattern="[0-9]{10,11}"
              required
            />
            <div class="mini-hint">숫자만 입력 (10~11자리)</div>
          </div>

          <button type="submit" class="primary-button">가입하기</button>

          <div class="login-actions">
            <button type="button" class="pill-button outline" data-action="show-login">로그인</button>
          </div>
        </form>
      </section>
    </main>
  </div>

  <script>
    (function () {
      const shell = document.querySelector(".auth-shell");
      if (!shell) return;

      const loginPanel = shell.querySelector(".auth-panel.login");
      const signupPanel = shell.querySelector(".auth-panel.signup");
      const toSignup = shell.querySelector("[data-action='show-signup']");
      const toLogin = shell.querySelector("[data-action='show-login']");

      const showLogin = () => {
        shell.classList.remove("is-signup");
        shell.classList.add("is-login");
        if (signupPanel) signupPanel.hidden = true;
        if (loginPanel) loginPanel.hidden = false;
      };

      const showSignup = () => {
        shell.classList.remove("is-login");
        shell.classList.add("is-signup");
        if (loginPanel) loginPanel.hidden = true;
        if (signupPanel) signupPanel.hidden = false;
      };

      if (toSignup) toSignup.addEventListener("click", (e) => { e.preventDefault(); showSignup(); });
      if (toLogin) toLogin.addEventListener("click", (e) => { e.preventDefault(); showLogin(); });
      showLogin();

      const loginSuccess = new URLSearchParams(window.location.search).has("loginSuccess");
      if (loginSuccess) {
        setTimeout(() => {
          window.location.href = "/owner/main";
        }, 1200);
      }

      // 비밀번호 일치 체크
      const pw = document.getElementById("signup-password");
      const pw2 = document.getElementById("signup-confirmPassword");
      const pwMsg = document.getElementById("pw-match-message");

      function setPwMessage(ok, text) {
        if (!pwMsg) return;
        pwMsg.classList.add("show");
        pwMsg.classList.toggle("ok", ok);
        pwMsg.classList.toggle("bad", !ok);
        pwMsg.textContent = text;
      }

      function checkPwMatch() {
        if (!pw || !pw2 || !pwMsg) return;
        if (!pw2.value) {
          pwMsg.classList.remove("show", "ok", "bad");
          pwMsg.textContent = "";
          return;
        }
        setPwMessage(pw.value === pw2.value, pw.value === pw2.value ? "비밀번호가 일치합니다." : "비밀번호가 일치하지 않습니다.");
      }

      if (pw) pw.addEventListener("input", checkPwMatch);
      if (pw2) pw2.addEventListener("input", checkPwMatch);

      // 이메일 중복 확인: GET /api/v1/store-owner/auth/exists/email?email=...
      const emailInput = document.getElementById("signup-email");
      const btnCheckEmail = document.getElementById("btn-check-email");
      const emailMsg = document.getElementById("email-check-message");

      function setEmailMessage(ok, text) {
        if (!emailMsg) return;
        emailMsg.classList.add("show");
        emailMsg.classList.toggle("ok", ok);
        emailMsg.classList.toggle("bad", !ok);
        emailMsg.textContent = text;
      }

      async function checkEmailDuplicate() {
        const email = (emailInput?.value || "").trim();
        if (!email) { setEmailMessage(false, "이메일을 먼저 입력하세요."); return; }

        try {
          const res = await fetch(`/api/v1/store-owner/auth/exists/email?email=${encodeURIComponent(email)}`, {
            method: "GET",
            headers: { "Accept": "application/json" }
          });
          const text = await res.text();
          const exists = String(text).trim() === "true";
          setEmailMessage(!exists, exists ? "이미 사용 중인 이메일입니다." : "사용 가능한 이메일입니다.");
        } catch (e) {
          setEmailMessage(false, "중복 확인 중 오류가 발생했습니다. 잠시 후 다시 시도해주세요.");
        }
      }

      if (btnCheckEmail) btnCheckEmail.addEventListener("click", (e) => { e.preventDefault(); checkEmailDuplicate(); });

      // 제출 전 최소 검증(비번 일치)
      const signupForm = document.getElementById("owner-signup-form");
      if (signupForm) {
        signupForm.addEventListener("submit", (e) => {
          if (pw && pw2 && pw.value !== pw2.value) {
            e.preventDefault();
            setPwMessage(false, "비밀번호가 일치하지 않습니다.");
            pw2.focus();
          }
        });
      }
    })();
  </script>
</body>
</html>
