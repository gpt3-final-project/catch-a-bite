<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>로그인 / 회원가입</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Gowun+Batang:wght@400;700&family=Gowun+Dodum&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #f2efe9;
      --panel: #f6f3ee;
      --panel-strong: #ffffff;
      --text: #2c2b29;
      --muted: #7a746d;
      --line: #d6d0c8;
      --accent: #7c7873;
      --accent-strong: #605c57;
      --notice-success: #dfe7db;
      --notice-error: #f1d7d3;
      --notice-info: #e6e2dd;
      --shadow: 0 18px 40px rgba(28, 24, 20, 0.12);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      background:
        radial-gradient(circle at top right, #ffffff 0%, rgba(255, 255, 255, 0.4) 35%, transparent 60%),
        linear-gradient(120deg, #efece6 0%, #f6f4ef 45%, #f1ede6 100%);
      color: var(--text);
      font-family: "Gowun Dodum", "Noto Sans KR", sans-serif;
    }

    body::before {
      content: "";
      position: fixed;
      inset: 0;
      background-image: radial-gradient(rgba(120, 112, 104, 0.12) 1px, transparent 1px);
      background-size: 24px 24px;
      opacity: 0.25;
      pointer-events: none;
    }

    .auth-shell {
      width: min(1100px, 92vw);
      margin: 56px auto 80px;
      display: grid;
      grid-template-columns: 1fr;
      gap: 28px;
      align-items: start;
      justify-items: center;
      position: relative;
      z-index: 1;
    }

    .auth-shell .auth-panel {
      width: min(520px, 100%);
    }

    .auth-shell.is-signup .auth-panel {
      width: min(760px, 100%);
    }

    .auth-panel[hidden] {
      display: none;
    }

    .auth-panel {
      border: 1px solid var(--line);
      border-radius: 10px;
      padding: 26px 32px 32px;
      box-shadow: var(--shadow);
      background: var(--panel);
      animation: panel-in 0.6s ease both;
    }

    .auth-panel.login {
      background: var(--panel-strong);
    }

    .panel-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 18px;
    }

    .auth-title {
      font-family: "Gowun Batang", serif;
      font-weight: 700;
      font-size: 20px;
      margin: 0;
      letter-spacing: 0.03em;
    }

    .auth-subtitle {
      margin: 4px 0 0;
      font-size: 13px;
      color: var(--muted);
    }

    .back-link {
      border: 1px solid var(--line);
      border-radius: 999px;
      padding: 6px 12px;
      font-size: 12px;
      color: var(--accent);
      text-decoration: none;
      background: #fff;
      white-space: nowrap;
    }

    .signup-form,
    .login-form {
      display: grid;
    }

    .field-group {
      margin-bottom: 16px;
      animation: field-rise 0.5s ease both;
      animation-delay: calc(var(--order) * 0.05s);
    }

    .field-group label {
      display: block;
      font-size: 13px;
      color: var(--muted);
      margin-bottom: 6px;
    }

    .field-row {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 10px;
    }

    .birth-row .field-row {
      grid-template-columns: repeat(3, minmax(0, 1fr));
    }

    input,
    select {
      width: 100%;
      border: 1px solid var(--line);
      border-radius: 4px;
      padding: 10px 12px;
      font-size: 14px;
      font-family: inherit;
      background: #fff;
      color: var(--text);
    }

    select {
      appearance: none;
      background-image: linear-gradient(45deg, transparent 50%, var(--muted) 50%),
        linear-gradient(135deg, var(--muted) 50%, transparent 50%);
      background-position: calc(100% - 18px) 50%, calc(100% - 13px) 50%;
      background-size: 5px 5px, 5px 5px;
      background-repeat: no-repeat;
      padding-right: 28px;
    }

    input:focus,
    select:focus {
      outline: 2px solid rgba(100, 96, 90, 0.2);
      border-color: var(--accent);
    }

    .ghost-button {
      border: 1px solid var(--line);
      background: #86827d;
      color: #f7f4ef;
      padding: 10px 16px;
      border-radius: 4px;
      font-size: 13px;
      cursor: pointer;
      white-space: nowrap;
    }

    .primary-button {
      margin-top: 10px;
      border: none;
      background: var(--accent);
      color: #f7f4ef;
      padding: 12px 0;
      border-radius: 6px;
      font-size: 15px;
      cursor: pointer;
      letter-spacing: 0.04em;
    }

    .notice-stack {
      display: grid;
      gap: 8px;
      margin-bottom: 18px;
    }

    .notice {
      padding: 10px 12px;
      border-radius: 6px;
      font-size: 13px;
    }

    .notice.success {
      background: var(--notice-success);
    }

    .notice.error {
      background: var(--notice-error);
    }

    .notice.info {
      background: var(--notice-info);
    }

    .line-field {
      display: block;
      margin-bottom: 18px;
      animation: field-rise 0.5s ease both;
      animation-delay: calc(var(--order) * 0.05s);
    }

    .line-field span {
      display: block;
      font-size: 13px;
      color: var(--muted);
      margin-bottom: 6px;
    }

    .line-field input {
      border: none;
      border-bottom: 2px solid #bfbab3;
      border-radius: 0;
      padding: 8px 0;
      background: transparent;
    }

    .line-field input:focus {
      outline: none;
      border-bottom-color: var(--accent);
    }

    .login-actions {
      display: flex;
      gap: 12px;
      justify-content: center;
      margin-top: 18px;
    }

    .pill-button {
      border: 2px solid var(--accent);
      background: var(--accent);
      color: #fff;
      padding: 6px 18px;
      border-radius: 999px;
      font-size: 13px;
      text-decoration: none;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    .pill-button.outline {
      background: transparent;
      color: var(--accent);
    }

    button:focus-visible,
    a:focus-visible {
      outline: 2px solid rgba(100, 96, 90, 0.4);
      outline-offset: 2px;
    }

    @media (max-width: 560px) {
      .auth-shell {
        width: 92vw;
        margin: 36px auto 60px;
      }

      .auth-panel {
        padding: 24px 22px 28px;
      }

      .field-row {
        grid-template-columns: 1fr;
      }

      .birth-row .field-row {
        grid-template-columns: 1fr 1fr;
      }
    }

    @media (prefers-reduced-motion: reduce) {
      .auth-panel,
      .field-group,
      .line-field {
        animation: none;
      }
    }

    @keyframes panel-in {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes field-rise {
      from {
        opacity: 0;
        transform: translateY(14px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>
</head>
<body>
  <div id="auth-root">
    <main class="auth-shell is-login">
      <section class="auth-panel login" id="login-panel">
        <div class="panel-header">
          <div>
            <h1 class="auth-title">로그인</h1>
            <p class="auth-subtitle">라이더</p>
          </div>
          <a class="back-link" href="/auth/select">유형 변경</a>
        </div>
        <div class="notice-stack" th:if="${param.signup != null or param.loginSuccess != null or param.error != null or param.logout != null}">
          <div class="notice success" th:if="${param.signup}">회원가입이 완료되었습니다. 로그인해주세요.</div>
          <div class="notice success" th:if="${param.loginSuccess}">로그인에 성공했습니다. 잠시 후 이동합니다.</div>
          <div class="notice error" th:if="${param.error}">아이디 또는 비밀번호가 올바르지 않습니다.</div>
          <div class="notice info" th:if="${param.logout}">로그아웃 되었습니다.</div>
        </div>
        <form class="login-form" action="/auth/rider/login" method="post">
          <input type="hidden" th:if="${_csrf != null}" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
          <label class="line-field" style="--order: 1;">
            <span>이메일</span>
            <input name="loginKey" type="text" autoComplete="username" required />
          </label>
          <label class="line-field" style="--order: 2;">
            <span>비밀번호</span>
            <input name="password" type="password" autoComplete="current-password" required />
          </label>
          <div class="login-actions">
            <button type="submit" class="pill-button">로그인</button>
            <button type="button" class="pill-button outline" data-action="show-signup">회원가입</button>
          </div>
        </form>
      </section>

      <section class="auth-panel signup" id="signup-panel" hidden>
        <div class="panel-header">
          <div>
            <h1 class="auth-title">회원 가입</h1>
            <p class="auth-subtitle">라이더</p>
          </div>
          <a class="back-link" href="/auth/select">유형 변경</a>
        </div>
        <form class="signup-form" action="/auth/rider/signup" method="post">
          <input type="hidden" th:if="${_csrf != null}" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
          <div class="field-group" style="--order: 1;">
            <label>이메일</label>
            <div class="field-row">
              <input
                id="signup-loginId"
                name="loginId"
                type="text"
                placeholder="user@test.com"
                autoComplete="username"
                required
              />
              <button type="button" class="ghost-button">중복확인</button>
            </div>
          </div>
          <div class="field-group" style="--order: 2;">
            <label>비밀번호</label>
            <input id="signup-password" name="password" type="password" autoComplete="new-password" required />
          </div>
          <div class="field-group" style="--order: 3;">
            <label>비밀번호 재확인</label>
            <input id="signup-password-confirm" name="confirmPassword" type="password" autoComplete="new-password" required />
          </div>
          <div class="field-group" style="--order: 4;">
            <label>이름</label>
            <input id="signup-name" name="name" type="text" />
          </div>
          <div class="field-group" style="--order: 5;">
            <label>닉네임</label>
            <input id="signup-nickname" name="nickname" type="text" />
          </div>
          <div class="field-group birth-row" style="--order: 6;">
            <label>생년월일</label>
            <div class="field-row">
              <select name="birthYear">
                <option value="">년(4자)</option>
              </select>
              <select name="birthMonth">
                <option value="">월</option>
              </select>
              <select name="birthDay">
                <option value="">일</option>
              </select>
            </div>
          </div>
          <div class="field-group" style="--order: 7;">
            <label>이동 수단</label>
            <select name="vehicleType" required>
              <option value="">선택</option>
              <option value="MOTORBIKE">오토바이</option>
              <option value="CAR">자동차</option>
              <option value="BICYCLE">자전거</option>
              <option value="WALKING">도보</option>
            </select>
            <div class="field-group" id="vehicle-info-block" style="--order: 8;" hidden>
              <label>면허번호</label>
              <input id="signup-licenseNumber" name="licenseNumber" type="text" placeholder="면허번호" />
            </div>

            <div class="field-group" id="vehicle-number-block" style="--order: 9;" hidden>
              <label>차량번호</label>
              <input id="signup-vehicleNumber" name="vehicleNumber" type="text" placeholder="차량번호" />
            </div>
          </div>
          <div class="field-group" style="--order: 10;">
            <label>휴대폰</label>
            <input
              id="signup-mobile"
              name="mobile"
              type="tel"
              inputMode="numeric"
              placeholder="01012345678"
              pattern="[0-9]{11}"
            />
          </div>
          <button type="submit" class="primary-button">가입하기</button>
          <div class="login-actions">
            <button type="button" class="pill-button outline" data-action="show-login">로그인</button>
          </div>
        </form>
      </section>
    </main>
  </div>

  <script>
    (function () {
      const shell = document.querySelector(".auth-shell");
      if (!shell) return;

      const loginPanel = shell.querySelector(".auth-panel.login");
      const signupPanel = shell.querySelector(".auth-panel.signup");
      const toSignup = shell.querySelector("[data-action='show-signup']");
      const toLogin = shell.querySelector("[data-action='show-login']");

      const showLogin = () => {
        shell.classList.remove("is-signup");
        shell.classList.add("is-login");
        if (signupPanel) signupPanel.hidden = true;
        if (loginPanel) loginPanel.hidden = false;
      };

      const showSignup = () => {
        shell.classList.remove("is-login");
        shell.classList.add("is-signup");
        if (loginPanel) loginPanel.hidden = true;
        if (signupPanel) signupPanel.hidden = false;
      };

      if (toSignup) {
        toSignup.addEventListener("click", (event) => {
          event.preventDefault();
          showSignup();
        });
      }

      if (toLogin) {
        toLogin.addEventListener("click", (event) => {
          event.preventDefault();
          showLogin();
        });
      }

      showLogin();

      const loginSuccess = new URLSearchParams(window.location.search).has("loginSuccess");
      if (loginSuccess) {
        setTimeout(() => {
          window.location.href = "/rider/main";
        }, 1200);
      }

      const yearSelect = shell.querySelector("select[name='birthYear']");
      const monthSelect = shell.querySelector("select[name='birthMonth']");
      const daySelect = shell.querySelector("select[name='birthDay']");

      if (yearSelect) {
        const currentYear = new Date().getFullYear();
        for (let i = 0; i < 70; i += 1) {
          const year = currentYear - i;
          const option = document.createElement("option");
          option.value = String(year);
          option.textContent = String(year);
          yearSelect.appendChild(option);
        }
      }

      if (monthSelect) {
        for (let month = 1; month <= 12; month += 1) {
          const option = document.createElement("option");
          option.value = String(month);
          option.textContent = String(month);
          monthSelect.appendChild(option);
        }
      }

      if (daySelect) {
        for (let day = 1; day <= 31; day += 1) {
          const option = document.createElement("option");
          option.value = String(day);
          option.textContent = String(day);
          daySelect.appendChild(option);
        }
      }
      
      const vehicleSelect = shell.querySelector("select[name='vehicleType']");
      const vehicleInfoBlock = document.getElementById("vehicle-info-block");
      const vehicleNumberBlock = document.getElementById("vehicle-number-block");
      const licenseInput = document.getElementById("signup-licenseNumber");
      const vehicleNumberInput = document.getElementById("signup-vehicleNumber");

      const toggleVehicleFields = () => {
        const v = vehicleSelect ? vehicleSelect.value : "";
        const needs = v === "MOTORBIKE" || v === "CAR";

        if (vehicleInfoBlock) vehicleInfoBlock.hidden = !needs;
        if (vehicleNumberBlock) vehicleNumberBlock.hidden = !needs;

        if (licenseInput) licenseInput.required = needs;
        if (vehicleNumberInput) vehicleNumberInput.required = needs;

        if (!needs) {
          if (licenseInput) licenseInput.value = "";
          if (vehicleNumberInput) vehicleNumberInput.value = "";
        }
      };

      if (vehicleSelect) {
        vehicleSelect.addEventListener("change", toggleVehicleFields);
        toggleVehicleFields();
      }
    })();
  </script>
</body>
</html>

