<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PortOne 결제 테스트</title>
    <!-- PortOne SDK -->
    <script src="https://cdn.iamport.kr/v1/iamport.js"></script>
</head>
<body>
    <div style="max-width: 500px; margin: 50px auto; padding: 20px; border: 1px solid #ccc;">
        <h1>결제 테스트</h1>
        
        <form id="paymentForm">
            <div>
                <label>Imp Key:</label>
                <input type="text" id="impKey" placeholder="imp_1234567890" required>
            </div>
            
            <div>
                <label>Merchant UID:</label>
                <input type="text" id="merchantUid" placeholder="ORDER_1_1705163250000" required>
            </div>
            
            <div>
                <label>결제 금액 (원):</label>
                <input type="number" id="amount" placeholder="10000" required>
            </div>
            
            <div>
                <label>구매자 이름:</label>
                <input type="text" id="buyerName" placeholder="테스트" required>
            </div>
            
            <div>
                <label>구매자 이메일:</label>
                <input type="email" id="buyerEmail" placeholder="test@example.com" required>
            </div>
            
            <div>
                <label>구매자 전화:</label>
                <input type="tel" id="buyerPhone" placeholder="01012345678" required>
            </div>
            
            <button type="button" onclick="requestPayment()">결제 진행</button>
        </form>
        
        <div id="result" style="margin-top: 20px; padding: 10px; background: #f0f0f0; display: none;">
            <h3>결제 결과:</h3>
            <pre id="resultText"></pre>
        </div>
    </div>

    <script>
        function requestPayment() {
            const IMP = window.IMP;
            IMP.init("imp_1234567890");  // ← 당신의 Imp Key로 교체
            
            const form = document.getElementById('paymentForm');
            const impKey = document.getElementById('impKey').value;
            const merchantUid = document.getElementById('merchantUid').value;
            const amount = document.getElementById('amount').value;
            const buyerName = document.getElementById('buyerName').value;
            const buyerEmail = document.getElementById('buyerEmail').value;
            const buyerPhone = document.getElementById('buyerPhone').value;
            
            IMP.request_pay({
                pg: 'portone',  // PortOne
                pay_method: 'card',
                merchant_uid: merchantUid,
                name: '배달앱 테스트 결제',
                amount: parseInt(amount),
                buyer_email: buyerEmail,
                buyer_name: buyerName,
                buyer_tel: buyerPhone
            }, function(rsp) {
                if (rsp.success) {
                    // ✅ 결제 성공
                    document.getElementById('result').style.display = 'block';
                    document.getElementById('resultText').textContent = 
                        '✅ 결제 성공!\n\n' +
                        'imp_uid: ' + rsp.imp_uid + '\n' +
                        'merchant_uid: ' + rsp.merchant_uid + '\n' +
                        'amount: ' + rsp.paid_amount + '\n\n' +
                        '다음 단계: /api/payments/complete 호출';
                    
                    // 여기서 /api/payments/complete 호출 가능
                    completePayment(rsp.imp_uid, merchantUid);
                } else {
                    // ❌ 결제 실패
                    document.getElementById('result').style.display = 'block';
                    document.getElementById('resultText').textContent = 
                        '❌ 결제 실패\n\n' +
                        'error: ' + rsp.error_msg;
                }
            });
        }
        
        function completePayment(impUid, merchantUid) {
            // YARC에서도 호출할 수 있지만, 
            // 여기서 자동으로 호출할 수도 있음
            console.log('impUid:', impUid);
            console.log('merchantUid:', merchantUid);
        }
    </script>
</body>
</html>
